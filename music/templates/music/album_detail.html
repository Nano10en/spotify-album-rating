{% extends "music/base.html" %}
{% load static %}

{% block content %}
    <div class="album-details">
        <div class="album-info">
            <h1>{{ album.name }}</h1>
            <p>{% for artist in album.artists %}
            {{ artist.name }}{% if not forloop.last %}, {% endif %}
            {% endfor %}</p>
            <img src="{{ album.images.0.url }}" alt="{{ album.name }} Cover">
            <div>
                <span>Release Date: {{ album.release_date }}</span>
                <span>Tracks: {{ tracks|length }}</span>
            </div>
        </div>
        <div class="tracks">
            {% for track in tracks %}
            <div class="track-info">
                <p>{{track.track_number}}. {{ track.name }}</p>
                <i class="fa-solid fa-arrow-down"></i>
            </div>
            <div class="track-separator">
                <form action="{% url 'create_track_comment' album.id track.id %}" method="post">
                    {% csrf_token %}
                    <div class="review-section">
                        <div class="star-wrapper">
                            <input type="radio" name="rating" id="r10_{{ track.id }}" value="10">
                            <label for="r10_{{ track.id }}" class="fa-regular fa-heart"></label>

                            <input type="radio" name="rating" id="r9_{{ track.id }}" value="9">
                            <label for="r9_{{ track.id }}" class="fa-regular fa-heart"></label>

                            <input type="radio" name="rating" id="r8_{{ track.id }}" value="8">
                            <label for="r8_{{ track.id }}" class="fa-regular fa-heart"></label>

                            <input type="radio" name="rating" id="r7_{{ track.id }}" value="7">
                            <label for="r7_{{ track.id }}" class="fa-regular fa-heart"></label>

                            <input type="radio" name="rating" id="r6_{{ track.id }}" value="6">
                            <label for="r6_{{ track.id }}" class="fa-regular fa-heart"></label>

                            <input type="radio" name="rating" id="r5_{{ track.id }}" value="5">
                            <label for="r5_{{ track.id }}" class="fa-regular fa-heart"></label>

                            <input type="radio" name="rating" id="r4_{{ track.id }}" value="4">
                            <label for="r4_{{ track.id }}" class="fa-regular fa-heart"></label>

                            <input type="radio" name="rating" id="r3_{{ track.id }}" value="3">
                            <label for="r3_{{ track.id }}" class="fa-regular fa-heart"></label>

                            <input type="radio" name="rating" id="r2_{{ track.id }}" value="2">
                            <label for="r2_{{ track.id }}" class="fa-regular fa-heart"></label>

                            <input type="radio" name="rating" id="r1_{{ track.id }}" value="1">
                            <label for="r1_{{ track.id }}" class="fa-regular fa-heart"></label>
                        </div>
                        <div class="comment-section">
                            <label for="track_comment_{{ track.id }}">Comment</label>
                            <textarea type="text" id="track_comment_{{ track.id }}" name="comment" required></textarea>
                        </div>
                        <div class="button-section">
                            <button type="submit">Submit Rating</button>
                        </div>
                    </div>
                </form>
                <div class="show-comment">
                    {% for track_comment in tracks_comments %}
                        {% if track_comment.track_id == track.id %}
                            <div>
                                <div class="author-rating">
                                    {% if request.user.spotifyprofile.display_name != "" %}
                                        <span>{{ request.user.spotifyprofile.display_name }}</span>
                                    {% else %}
                                        <span>{{ request.user.username }}</span>
                                    {% endif %}
                                    <span>Rating: {{ track_comment.rating }}/10</span>
                                </div>
                                <p>{{ track_comment.content }}</p>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="review">
        <form action="{% url 'create_comment' album.id %}" method="post">
            {% csrf_token %}
            <div class="review-section">
                <div class="star-wrapper">
                    <a href="#" class="fas fa-star s1"></a>
                    <a href="#" class="fas fa-star s2"></a>
                    <a href="#" class="fas fa-star s3"></a>
                    <a href="#" class="fas fa-star s4"></a>
                    <a href="#" class="fas fa-star s5"></a>
                    <a href="#" class="fas fa-star s6"></a>
                    <a href="#" class="fas fa-star s7"></a>
                    <a href="#" class="fas fa-star s8"></a>
                    <a href="#" class="fas fa-star s9"></a>
                    <a href="#" class="fas fa-star s10"></a>
                </div>
                <div class="comment-section">
                    <label for="track_comment_{{ track.id }}">Comment</label>
                    <textarea type="text" id="track_comment_{{ track.id }}" name="comment" required></textarea>
                </div>
                <div class="button-section">
                    <button type="submit">Submit Rating</button>
                </div>
            </div>
        </form>
    </div>
    <div class="comments">
        <h2>Comments</h2>
        {% for comment in comments %}
            <div>
                <p><strong>{{ comment.author.spotifyprofile.display_name }}</strong>: {{ comment.content }} (Rating: {{ comment.rating }}/10)</p>
            </div>
        {% empty %}
            <p>No comments yet.</p>
        {% endfor %}
    </div>
{% endblock content %}